{% extends "base.html" %} {% block body %}
<div class="container mt-5">
  <h2>Available Courses</h2>

  {% if courses %}
  <div class="row g-4 mt-3">
    {% for item in courses %}
    <div class="col-md-6 col-lg-4 d-flex flex-column">
      <a
        href="{% if item.is_enrolled %}{{ url_for('courses.course_dashboard', course_id=item.course.id) }}{% else %}{{ url_for('courses.course_detail', course_id=item.course.id) }}{% endif %}"
        class="text-decoration-none flex-grow-1"
      >
        <div class="card border-success pointer course-card h-100">
          <div class="card-body">
            <!-- Course Code and Title -->
            <h5 class="card-title">{{ item.course.code }}</h5>
            <h6 class="card-subtitle mb-2 text-muted">
              {{ item.course.title }}
            </h6>

            <!-- Course Details -->
            <p class="card-text">
              <small>
                <strong>Units:</strong> {{ item.course.credits }} |
                <strong>Format:</strong> {{ item.course.format }}<br />
                <strong>Professor:</strong> {{ item.course.professor }}<br />
                <strong>Enrolled:</strong> {{ item.course.get_student_count() }}
                {% if item.course.max_students %} / {{ item.course.max_students
                }} {% endif %}
              </small>
            </p>

            <p class="card-text">{{ item.course.description }}</p>

            <!-- Availability Status -->
            {% if item.course.availability %}
            <span class="badge bg-success">Available</span>
            {% else %}
            <span class="badge bg-danger">Closed</span>
            {% endif %}

            <!-- Enrolled Badge -->
            {% if item.is_enrolled %}
            <span class="badge bg-primary">Enrolled</span>
            {% endif %}
          </div>
        </div>
      </a>

      <!-- Action Buttons (Outside Link) -->
      <div class="mb-4 mt-2">
        {% if current_user.is_authenticated and (item.course.professor_id ==
        current_user.id or current_user.is_admin) %}
        <!-- Edit button for course owners/admins -->
        <a
          href="{{ url_for('courses.course_dashboard', course_id=item.course.id) }}"
          class="btn btn-sm btn-secondary w-100 mb-2"
        >
          View Dashboard
        </a>
        <a
          href="{{ url_for('courses.update_course', course_id=item.course.id) }}"
          class="btn btn-sm btn-primary w-100"
        >
          Edit Course
        </a>
        {% elif item.is_enrolled %}
        <!-- View Dashboard button for enrolled students -->
        <a
          href="{{ url_for('courses.course_dashboard', course_id=item.course.id) }}"
          class="btn btn-sm btn-secondary w-100 mb-2"
        >
          View Dashboard
        </a>
        <form
          method="POST"
          action="{{ url_for('courses.drop_course', course_id=item.course.id) }}"
          style="display: inline"
        >
          <button type="submit" class="btn btn-sm btn-outline-danger w-100">
            Drop Course
          </button>
        </form>
        {% elif current_user.is_authenticated and current_user.is_student %} {%
        if item.course.availability %}
        <form
          method="POST"
          action="{{ url_for('courses.enroll_course', course_id=item.course.id) }}"
          style="display: inline"
        >
          <button type="submit" class="btn btn-sm btn-primary w-100">
            Enroll
          </button>
        </form>
        {% endif %} {% elif not current_user.is_authenticated %}
        <a
          href="{{ url_for('auth.login') }}"
          class="btn btn-sm btn-outline-primary w-100"
        >
          Login to Enroll
        </a>
        {% endif %}
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <p class="alert alert-info mt-3">No courses available.</p>
  {% endif %}
</div>
{% endblock %}
